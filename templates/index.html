<!DOCTYPE html>
<html lang="th">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Check-in | Computer Lab</title>
    <link rel="stylesheet" href="{{ url_for('static', filename='user_style.css') }}">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        /* ‡πÄ‡∏û‡∏¥‡πà‡∏° CSS ‡πÄ‡∏â‡∏û‡∏≤‡∏∞‡∏Å‡∏¥‡∏à‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö Map Modal ‡πÉ‡∏ô‡∏´‡∏ô‡πâ‡∏≤ User */
        #userMapContainer { max-height: 60vh; overflow-y: auto; margin: 15px 0; }
        .map-legend-user { display: flex; justify-content: center; gap: 15px; margin-bottom: 10px; font-size: 0.8rem; color: #666; }
        .desk-item.user-view { cursor: default; pointer-events: none; } /* ‡∏´‡πâ‡∏≤‡∏°‡∏Ñ‡∏•‡∏¥‡∏Å */
        
        /* ‡∏õ‡∏∏‡πà‡∏°‡∏•‡∏≠‡∏¢‡∏°‡∏∏‡∏°‡∏Ç‡∏ß‡∏≤‡∏ö‡∏ô‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡∏î‡∏π‡πÅ‡∏ú‡∏ô‡∏ú‡∏±‡∏á */
        .top-right-nav {
            position: fixed;
            top: 20px;
            right: 20px;
            z-index: 100;
        }
        .btn-map-float {
            background: white;
            border: 1px solid #ddd;
            padding: 8px 15px;
            border-radius: 30px;
            box-shadow: 0 4px 6px rgba(0,0,0,0.1);
            font-weight: 600;
            color: var(--primary);
            cursor: pointer;
            transition: all 0.2s;
            display: flex;
            align-items: center;
            gap: 5px;
        }
        .btn-map-float:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 12px rgba(0,0,0,0.15);
        }
    </style>
</head>
<body>

    <!-- üåü NEW: ‡∏õ‡∏∏‡πà‡∏°‡∏î‡∏π‡πÅ‡∏ú‡∏ô‡∏ú‡∏±‡∏á ‡πÅ‡∏¢‡∏Å‡∏≠‡∏≠‡∏Å‡∏°‡∏≤‡πÑ‡∏ß‡πâ‡∏Ç‡∏ß‡∏≤‡∏ö‡∏ô -->
    <div class="top-right-nav">
        <button onclick="openUserMapModal()" class="btn-map-float">
            <i class="fa-solid fa-map-location-dot"></i> ‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞‡∏ó‡∏µ‡πà‡∏ô‡∏±‡πà‡∏á
        </button>
    </div>

    <section class="user-container">
        <div class="login-card">
            
            <div class="text-center mb-4">
                <div class="mb-2"> 
                    <img src="{{ url_for('static', filename='img/logo.png') }}" alt="Logo" class="logo-img" onerror="this.style.display='none'">
                </div>
                <h2 class="page-title">‡∏•‡∏á‡∏ä‡∏∑‡πà‡∏≠‡πÄ‡∏Ç‡πâ‡∏≤‡πÉ‡∏ä‡πâ‡∏´‡πâ‡∏≠‡∏á Lab</h2>
            </div>
            
            <div class="login-card-content mt-4">
                
                <!-- Tab ‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏õ‡∏£‡∏∞‡πÄ‡∏†‡∏ó (‡πÄ‡∏≠‡∏≤‡∏õ‡∏∏‡πà‡∏°‡∏î‡∏π‡πÅ‡∏ú‡∏ô‡∏ú‡∏±‡∏á‡∏≠‡∏≠‡∏Å‡πÅ‡∏•‡πâ‡∏ß) -->
                <div class="tab-container">
                    <button type="button" onclick="selectUserType('staff')" id="btnStaff" class="tab-btn active">
                        üè¢ ‡∏ö‡∏∏‡∏Ñ‡∏•‡∏≤‡∏Å‡∏£ / ‡∏ô‡∏®.
                    </button>
                    <button type="button" onclick="selectUserType('guest')" id="btnGuest" class="tab-btn">
                        üë§ ‡∏ö‡∏∏‡∏Ñ‡∏Ñ‡∏•‡∏ó‡∏±‡πà‡∏ß‡πÑ‡∏õ
                    </button>
                </div>

                <div id="viewManual">
                    <form id="checkinForm" onsubmit="handleCheckIn(event)">
                        
                        <div class="mb-4">
                            <input type="text" id="studentId" class="input-field" placeholder="‡∏£‡∏´‡∏±‡∏™‡∏ô‡∏±‡∏Å‡∏®‡∏∂‡∏Å‡∏©‡∏≤ / ‡∏£‡∏´‡∏±‡∏™‡∏ö‡∏∏‡∏Ñ‡∏•‡∏≤‡∏Å‡∏£" autocomplete="off" autofocus style="letter-spacing: 0;">
                        </div>

                        <div class="hidden">
                            <input type="radio" name="userCategory" id="radioStaff" value="staff" checked>
                            <input type="radio" name="userCategory" id="radioGuest" value="guest">
                        </div>

                        <!-- 1. ‡∏£‡∏π‡∏õ‡πÅ‡∏ö‡∏ö‡∏Å‡∏≤‡∏£‡πÄ‡∏Ç‡πâ‡∏≤‡πÉ‡∏ä‡πâ -->
                        <div class="mb-4">
                            <label class="form-label">1. ‡∏£‡∏π‡∏õ‡πÅ‡∏ö‡∏ö‡∏Å‡∏≤‡∏£‡πÄ‡∏Ç‡πâ‡∏≤‡πÉ‡∏ä‡πâ</label>
                            <div class="radio-group">
                                <label class="selection-card bg-gray">
                                    <input type="radio" name="accessType" value="booking" checked>
                                    <span>üìÖ ‡∏à‡∏≠‡∏á‡∏°‡∏≤</span>
                                </label>
                                <label class="selection-card bg-gray">
                                    <input type="radio" name="accessType" value="walkin">
                                    <span>üö∂ Walk-in</span>
                                </label>
                            </div>
                        </div>

                        <!-- 2. ‡∏ß‡∏±‡∏ï‡∏ñ‡∏∏‡∏õ‡∏£‡∏∞‡∏™‡∏á‡∏Ñ‡πå -->
                        <div class="mb-4">
                            <label class="form-label">2. ‡∏ß‡∏±‡∏ï‡∏ñ‡∏∏‡∏õ‡∏£‡∏∞‡∏™‡∏á‡∏Ñ‡πå</label>
                            <div class="radio-group">
                                <label class="selection-card usage-computer">
                                    <input type="radio" name="usageType" value="computer" checked onchange="toggleAiSelect(false)">
                                    <span>üíª ‡∏Ñ‡∏≠‡∏°‡∏Ø ‡∏ó‡∏±‡πà‡∏ß‡πÑ‡∏õ</span>
                                </label>
                                <label class="selection-card usage-ai">
                                    <input type="radio" name="usageType" value="ai" onchange="toggleAiSelect(true)">
                                    <span>ü§ñ ‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô AI</span>
                                </label>
                            </div>
                            
                            <div id="aiSelection" class="mt-2 hidden" style="animation: fadeIn 0.3s;">
                                <select id="aiTool" class="input-field" style="padding: 10px; font-size: 0.9rem; margin-top: 5px;">
                                    <option value="ChatGPT">üü¢ ChatGPT</option>
                                    <option value="Gemini">üîµ Google Gemini</option>
                                    <option value="Midjourney">üé® Midjourney</option>
                                    <option value="Copilot">üíª GitHub Copilot</option>
                                    <option value="Other">‚ö™ ‡∏≠‡∏∑‡πà‡∏ô‡πÜ</option>
                                </select>
                            </div>
                        </div>

                        <!-- 3. Guest Fields -->
                        <div id="guestFields" class="hidden mb-4">
                            <div class="flex gap-2">
                                <input type="text" id="username" class="input-field" placeholder="‡∏ä‡∏∑‡πà‡∏≠" style="margin:0; text-align:left;">
                                <input type="text" id="surname" class="input-field" placeholder="‡∏ô‡∏≤‡∏°‡∏™‡∏Å‡∏∏‡∏•" style="margin:0; text-align:left;">
                            </div>
                        </div>

                        <button type="submit" class="btn btn-primary w-full" style="padding: 14px; font-size: 16px;">
                            LOGIN
                        </button>
                    </form>
                </div>

            </div>
        </div>
    </section>

    <!-- Success Modal -->
    <div id="successModal" class="modal-overlay">
        <div class="modal-content">
            <div class="icon-circle">
                <span class="success-icon">‚úì</span>
            </div>
            <h3 class="font-bold text-main" style="font-size: 20px; margin-bottom: 5px;">Check-in ‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à!</h3>
            <div class="bg-gray" style="padding: 15px; border-radius: 10px; margin: 20px 0;">
                <p id="modalUserName" class="font-bold" style="color: var(--primary); font-size: 1.1rem; margin-bottom: 5px;">Loading...</p>
                <p id="modalUserTime" class="text-light text-sm">Loading...</p>
            </div>
            <button onclick="closeModal()" class="btn btn-primary w-full justify-center">‡∏ï‡∏Å‡∏•‡∏á</button>
        </div>
    </div>

    <!-- Map Modal (‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö User ‡∏î‡∏π‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞) -->
    <div id="mapModal" class="modal-overlay">
        <div class="modal-content" style="text-align: left; max-width: 600px; width: 95%;">
            <div class="flex justify-between items-center mb-2">
                <h3 class="font-bold text-main" style="font-size: 1.2rem;">üó∫Ô∏è ‡∏ú‡∏±‡∏á‡∏ó‡∏µ‡πà‡∏ô‡∏±‡πà‡∏á (Real-time)</h3>
                <button onclick="closeMapModal()" style="background:none; border:none; font-size:1.5rem; cursor:pointer; color:#666;">&times;</button>
            </div>
            
            <div class="map-legend-user">
                <div style="display:flex; align-items:center; gap:5px;"><div style="width:12px; height:12px; background:#fff; border:1px solid #ccc;"></div> ‡∏ß‡πà‡∏≤‡∏á</div>
                <div style="display:flex; align-items:center; gap:5px;"><div style="width:12px; height:12px; background:#f0fdf4; border:1px solid #16a34a;"></div> ‡πÑ‡∏°‡πà‡∏ß‡πà‡∏≤‡∏á</div>
                <div style="display:flex; align-items:center; gap:5px;"><div style="width:12px; height:12px; background:#fef2f2; border:1px solid #ef4444;"></div> ‡∏õ‡∏¥‡∏î‡∏ã‡πà‡∏≠‡∏°</div>
            </div>

            <div id="userMapContainer">
                <!-- JS ‡∏à‡∏∞‡∏ß‡∏≤‡∏î‡πÅ‡∏ú‡∏ô‡∏ú‡∏±‡∏á‡∏ï‡∏£‡∏á‡∏ô‡∏µ‡πâ -->
                <p class="text-center text-light">‡∏Å‡∏≥‡∏•‡∏±‡∏á‡πÇ‡∏´‡∏•‡∏î‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•...</p>
            </div>

            <button onclick="closeMapModal()" class="btn btn-outline w-full justify-center">‡∏õ‡∏¥‡∏î‡∏´‡∏ô‡πâ‡∏≤‡∏ï‡πà‡∏≤‡∏á</button>
        </div>
    </div>

    <script src="{{ url_for('static', filename='script.js') }}"></script>
    <script>
        function toggleAiSelect(show) {
            const el = document.getElementById('aiSelection');
            if(show) el.classList.remove('hidden');
            else el.classList.add('hidden');
        }

        function selectUserType(type) {
            document.getElementById('btnStaff').classList.remove('active');
            document.getElementById('btnGuest').classList.remove('active');
            
            const guestFields = document.getElementById('guestFields');
            const stdInput = document.getElementById('studentId');

            if (type === 'staff') {
                document.getElementById('btnStaff').classList.add('active');
                document.getElementById('radioStaff').checked = true;
                guestFields.classList.add('hidden');
                stdInput.placeholder = "‡∏£‡∏´‡∏±‡∏™‡∏ô‡∏±‡∏Å‡∏®‡∏∂‡∏Å‡∏©‡∏≤ / ‡∏£‡∏´‡∏±‡∏™‡∏ö‡∏∏‡∏Ñ‡∏•‡∏≤‡∏Å‡∏£";
                stdInput.focus();
            } else {
                document.getElementById('btnGuest').classList.add('active');
                document.getElementById('radioGuest').checked = true;
                guestFields.classList.remove('hidden');
                stdInput.placeholder = "‡πÄ‡∏ö‡∏≠‡∏£‡πå‡πÇ‡∏ó‡∏£‡∏®‡∏±‡∏û‡∏ó‡πå (‡∏ñ‡πâ‡∏≤‡∏°‡∏µ)";
                document.getElementById('username').focus();
            }
        }
    </script>
</body>
</html>